{{ 'template-collection.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}

{% if section.settings.image_shape == 'blob' %}
  {{ 'mask-blobs.css' | asset_url | stylesheet_tag }}
{%- endif -%}

{%- unless section.settings.quick_add == 'none' -%}
  {{ 'quick-add.css' | asset_url | stylesheet_tag }}
{%- endunless -%}

{%- if section.settings.quick_add == 'standard' -%}
  <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{%- if section.settings.quick_add == 'bulk' -%}
  <script src="{{ 'quick-add-bulk.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'quantity-popover.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'price-per-item.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'quick-order-list.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .col-it-pad {
    padding: 12px;
  }

  .promo-bn {
    background-color: #1F727CFF;
  }


{%- endstyle -%}

<style>


  .promo_card__content {
    display: flex;
    flex-direction: column;
    /* justify-content: flex-end; */
    align-items: center;
    width: 50%;
    flex-grow: 1;
    position: relative;
  }

  .promo_card__content.center {
    justify-content: center;
  }
  .promo_card__content.end {
    justify-content: flex-end;
  }


  .promo-text {
    width: 10rem;
    text-align: center;
  }

  .promo-text-wrapper {
    margin-left: 4rem;
    width: 100%;
    align-items: left;
  }

  .promo_card_img_1 {
    position: absolute;
    left: 25%;
    height: 100%;
  }

  .promo_card_img_2 {
    position: absolute;
    left: 20%;
    height: 100%;
  }

  .promo-link-wrapper {
    background-color: #ff8674;
    padding: 1rem 4rem;
    display: inline-block;
    width: auto;
    width: 80%;
    text-align: center;
    max-width: 80%;
    margin: 3rem;
  }

  .promo-link {
    color: white;

    text-decoration: none;

    white-space: nowrap;

  }

  .promo_banner_text_2 {
    font-size: 3rem;
    color: white;
    margin: 1rem;
  }


  .pr_card_media div {
    position: relative;
  }
  .pr_card_media {
    height: 100%;
  }

  .pr_card_media img {
    position: absolute;
    height: auto;
    object-fit: cover;
    /* opacity: 0.3; */
    /* Регулює прозорість фону */
  }

  .pr_card_media img:nth-child(1) {
    top: 0;
    left: 0;
  }
  .pr_card_media img:nth-child(2) {
    top: 70%;
    left: 3%;
  }

  .pr_card_media img:nth-child(3) {
    right: 1%;
  }
  .pr_card_media img:nth-child(4) {
    bottom: 50%;
    right: 30%;
  }

  @media (min-width: 990px) {
    .grid--4-col-desktop .grid__item__promo {
      width: calc(25% - var(--grid-desktop-horizontal-spacing) * 3 / 4);
      max-width: calc(25% - var(--grid-desktop-horizontal-spacing) * 3 / 4);
    }
  }
  @media (max-width: 990px) {
    .grid--4-col-desktop .grid__item__promo {
      width: calc(100% - var(--grid-desktop-horizontal-spacing) * 3 / 4);
      max-width: calc(100% - var(--grid-desktop-horizontal-spacing) * 3 / 4);
    }
  }

</style>


<script>
  document.addEventListener("DOMContentLoaded", function(){
    let promoIndex = parseInt("{{ section.settings.promo_banner }}", 10);
    console.log("index" + promoIndex);
  
    let productList = document.querySelectorAll(".col-it-pad");
  
    
    let active_filter = false;
  
    const container = document.querySelector('.active-facets');
  const facetRemove = container?.querySelector('facet-remove');
  
  if (facetRemove && container.childElementCount === 1) {
      active_filter = false;
  } else {
      active_filter = true;
  }
  
  
  
    if (!isNaN(promoIndex) && promoIndex > 0 && promoIndex <= productList.length) {
      let promoHTML = active_filter 
        ? `
            <li class="col-it-pad grid__item__promo{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
                <div class="card-wrapper product-card-wrapper underline-links-hover">
                    <div class="card card--standard card--media" style="--ratio-percent: 125.0%;">
                        <div class="card__inner card_inner_promo color-{{section.settings.pr_color_scheme_2}} gradient ratio" style="--ratio-percent: 125.0%;">
                            <div class="card__media">
                                <div class="pr_card_media">
                                <img class="" src="https://cdn.shopify.com/s/files/1/0857/7741/6439/files/promo_vect_1.png?v=1740247189">
                                <img class="" src="https://cdn.shopify.com/s/files/1/0857/7741/6439/files/promo_vect_2.png?v=1740247202">
                                <img class="" src="https://cdn.shopify.com/s/files/1/0857/7741/6439/files/promo_vect_3.png?v=1740247334">
                                <img class="" src="https://cdn.shopify.com/s/files/1/0857/7741/6439/files/promo_vect_4.png?v=1740247340">
                                    
                                </div>
                            </div>
                            <div class="promo_card__content center" style="z-index: 777;">
                                <div class="">
                                    <p class="">{{ section.settings.promo_banner_text_min }}</p>
                                    <p class="promo_banner_text_2">SALE UP <br>TO {{ section.settings.promo_banner_text_2 }}% OFF</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>      
            </li>
        `
        : `
            <li class="col-it-pad grid__item__promo{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
                <div class="card-wrapper product-card-wrapper underline-links-hover">
                    <div class="card card--standard card--media" style="--ratio-percent: 125.0%;">
                        <div class="card__inner card_inner_promo color-{{section.settings.pr_color_scheme}} gradient ratio" style="--ratio-percent: 125.0%;">
                            <div class="card__media">
                                <div>
                                    <img class="promo_card_img_1" src="https://cdn.shopify.com/s/files/1/0857/7741/6439/files/pr_ban_img_sm.png?v=1739449053">
                                    <img class="promo_card_img_2" src="https://cdn.shopify.com/s/files/1/0857/7741/6439/files/line_rp_bn.png?v=1739449063">
                                </div>
                            </div>
                            <div class="promo_card__content end" style="z-index: 777;">
                                <div class="promo-text-wrapper">
                                    <h2 class="promo-text">{{ section.settings.promo_banner_text }}</h2>
                                </div>
                                <div class="promo-link-wrapper">
                                    <a href="/promo" class="promo-link">{{ section.settings.promo_banner_btn_text }}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>      
            </li>
        `;
  
    // Вставляємо банер у відповідне місце
    productList[promoIndex - 1].insertAdjacentHTML("afterend", promoHTML);
        
    }
  });
</script>

<div class="section-{{ section.id }}-padding gradient color-{{ section.settings.color_scheme }}">

  {%- capture contentForQuerystring -%}{{ content_for_header }}{%- endcapture -%}

  {%- assign pageUrlWithHost = contentForQuerystring | split: '"pageurl":"' | last | split: '"' | first | 
 replace: '\/', '/' | 
 replace: '%20', ' ' | 
 replace: '\u0026', '&'
  -%}

  {%- assign query_params = pageUrlWithHost | split: '?' -%}
  {%- if query_params.size > 1 -%}
    {%- assign params_list = query_params[1] | split: '&' -%}
    {%- for param in params_list -%}
      {%- if param contains 'products_count=' -%}
        {%- assign product_count_param = param | split: 'products_count=' -%}
        {%- assign products_per_page = product_count_param[1] | plus: 0 -%}
      {%- endif -%}
    {%- endfor -%}
  {%- else -%}
    {%- assign products_per_page = 16 -%}
  {%- endif -%}


  {%- paginate collection.products by products_per_page -%}

    {% comment %} Sort is the first tabbable element when filter type is vertical {% endcomment %}
    {%- if section.settings.enable_sorting and section.settings.filter_type == 'vertical' -%}
      <facet-filters-form class="facets facets-vertical-sort page-width small-hide">
        <form class="facets-vertical-form" id="FacetSortForm">
          <div class="facet-filters sorting caption">
            <div class="facet-filters__field">
              <h2 class="facet-filters__label caption-large text-body">
                <label for="SortBy">{{ 'products.facets.sort_by_label' | t }}</label>
              </h2>
              <div class="select">
                {%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}
                <select
                  name="sort_by"
                  class="facet-filters__sort select__select caption-large"
                  id="SortBy"
                  aria-describedby="a11y-refresh-page-message">
                  {%- for option in collection.sort_options -%}
                    <option
                      value="{{ option.value | escape }}"
                      {% if option.value == sort_by %}
                      selected="selected"
                      {% endif %}>
                      {{ option.name | escape }}
                    </option>
                  {%- endfor -%}
                </select>
                <span class="svg-wrapper">
                  {{- 'icon-caret.svg' | inline_asset_content -}}
                </span>
              </div>
            </div>
          </div>

          <div class="product-count-vertical light" role="status">
            <h2 class="product-count__text text-body">
              <span id="ProductCountDesktop">
                {%- if collection.results_count -%}
                  {{ 'templates.search.results_with_count'
 | t: terms: collection.terms, count: collection.results_count
                  }}
                {%- elsif collection.products_count == collection.all_products_count -%}
                  {{ 'products.facets.product_count_simple' | t: count: collection.products_count }}
                {%- else -%}
                  {{ 'products.facets.product_count'
 | t: product_count: collection.products_count, count: collection.all_products_count
                  }}
                {%- endif -%}
              </span>
            </h2>
            {%- render 'loading-spinner' -%}
          </div>
        </form>
      </facet-filters-form>
    {%- endif -%}

    <div class="{% if section.settings.filter_type == 'vertical' %} facets-vertical page-width{% endif %}">
      {{ 'component-facets.css' | asset_url | stylesheet_tag }}
      <script src="{{ 'facets.js' | asset_url }}" defer="defer"></script>
      {%- if section.settings.enable_filtering or section.settings.enable_sorting -%}
        <aside
          aria-labelledby="verticalTitle"
          class="facets-wrapper{% unless section.settings.enable_filtering %} facets-wrapper--no-filters{% endunless %}{% if section.settings.filter_type != 'vertical' %} page-width{% endif %}"
          id="main-collection-filters"
          data-id="{{ section.id }}">
          {% render 'facets'
            ,
 results: collection
            ,
 enable_filtering: section.settings.enable_filtering
            ,
 enable_sorting: section.settings.enable_sorting
            ,
 filter_type: section.settings.filter_type
            ,
 paginate: paginate
          %}
        </aside>
      {%- endif -%}

      <div
        class="product-grid-container{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
        id="ProductGridContainer"
        {% if settings.animations_reveal_on_scroll %}
        data-cascade
        {% endif %}>
        {%- if collection.products.size == 0 -%}
          <div
            class="collection collection--empty page-width"
            id="product-grid"
            data-id="{{ section.id }}">
            <div class="loading-overlay gradient"></div>
            <div class="title-wrapper center">
              <h2 class="title title--primary">
                {{ 'sections.collection_template.empty' | t -}}
                <br>
                {{ 'sections.collection_template.use_fewer_filters_html'
 | t: link: collection.url, class: 'underlined-link link'
                }}
              </h2>
            </div>
          </div>
        {%- else -%}
          <div class="collection{% if section.settings.filter_type != 'vertical' %} page-width{% endif %}">
            <div class="loading-overlay gradient"></div>
            <ul
              id="product-grid"
              data-id="{{ section.id }}"
              class="
                grid product-grid grid--{{ section.settings.columns_mobile }}-col-tablet-down
                grid--{{ section.settings.columns_desktop }}-col-desktop
                {% if section.settings.quick_add == 'bulk' %} collection-quick-add-bulk{% endif %}
              ">
              {% assign skip_card_product_styles = false %}
              {%- for product in collection.products -%}
                {% assign lazy_load = false %}
                {%- if forloop.index > 2 -%}
                  {%- assign lazy_load = true -%}
                {%- endif -%}
                <li
                  class="col-it-pad grid__item{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                  {% if settings.animations_reveal_on_scroll %}
                  data-cascade
                  style="--animation-order: {{ forloop.index }};"
                  {% endif %}>
                  {% render 'card-product'
                    ,
 card_product: product
                    ,
 media_aspect_ratio: section.settings.image_ratio
                    ,
 image_shape: section.settings.image_shape
                    ,
 show_secondary_image: section.settings.show_secondary_image
                    ,
 show_vendor: section.settings.show_vendor
                    ,
 show_rating: section.settings.show_rating
                    ,
 lazy_load: lazy_load
                    ,
 skip_styles: skip_card_product_styles
                    ,
 show_button: section.settings.show_button
                    ,
 quick_add: section.settings.quick_add
                    ,
 section_id: section.id
                  %}
                </li>
                {%- assign skip_card_product_styles = true -%}
              {%- endfor -%}
            </ul>

            {%- if paginate.pages > 1 -%}
              {% render 'pagination'
                , paginate: paginate
                , anchor: '' %}
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>
    </div>
  {%- endpaginate -%}
  {% if section.settings.image_shape == 'arch' %}
    {{ 'mask-arch.svg' | inline_asset_content }}
  {%- endif -%}
</div>

{% schema %}
  {
    "name": "t:sections.main-collection-product-grid.name",
    "class": "section",
    "settings": [

      {
        "type": "range",
        "id": "columns_desktop",
        "min": 1,
        "max": 6,
        "step": 1,
        "default": 4,
        "label": "t:sections.main-collection-product-grid.settings.columns_desktop.label"
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "t:sections.all.colors.label",
        "info": "t:sections.all.colors.has_cards_info",
        "default": "scheme-1"
      },
      {
        "type": "header",
        "content": "t:sections.main-collection-product-grid.settings.header__3.content"
      },
      {
        "type": "select",
        "id": "image_ratio",
        "options": [
          {
            "value": "adapt",
            "label": "t:sections.main-collection-product-grid.settings.image_ratio.options__1.label"
          }, {
            "value": "portrait",
            "label": "t:sections.main-collection-product-grid.settings.image_ratio.options__2.label"
          }, {
            "value": "square",
            "label": "t:sections.main-collection-product-grid.settings.image_ratio.options__3.label"
          }
        ],
        "default": "adapt",
        "label": "t:sections.main-collection-product-grid.settings.image_ratio.label"
      }, {
        "type": "select",
        "id": "image_shape",
        "options": [
          {
            "value": "default",
            "label": "t:sections.all.image_shape.options__1.label"
          },
          {
            "value": "arch",
            "label": "t:sections.all.image_shape.options__2.label"
          },
          {
            "value": "blob",
            "label": "t:sections.all.image_shape.options__3.label"
          },
          {
            "value": "chevronleft",
            "label": "t:sections.all.image_shape.options__4.label"
          }, {
            "value": "chevronright",
            "label": "t:sections.all.image_shape.options__5.label"
          }, {
            "value": "diamond",
            "label": "t:sections.all.image_shape.options__6.label"
          }, {
            "value": "parallelogram",
            "label": "t:sections.all.image_shape.options__7.label"
          }, {
            "value": "round",
            "label": "t:sections.all.image_shape.options__8.label"
          }
        ],
        "default": "default",
        "label": "t:sections.all.image_shape.label",
        "info": "t:sections.all.image_shape.info"
      }, {
        "type": "checkbox",
        "id": "show_secondary_image",
        "default": false,
        "label": "t:sections.main-collection-product-grid.settings.show_secondary_image.label"
      }, {
        "type": "checkbox",
        "id": "show_vendor",
        "default": false,
        "label": "t:sections.main-collection-product-grid.settings.show_vendor.label"
      }, {
        "type": "checkbox",
        "id": "show_button",
        "default": true,
        "label": "Show button"
      }, {
        "type": "checkbox",
        "id": "show_rating",
        "default": false,
        "label": "t:sections.main-collection-product-grid.settings.show_rating.label",
        "info": "t:sections.main-collection-product-grid.settings.show_rating.info"
      }, {
        "type": "select",
        "id": "quick_add",
        "default": "none",
        "label": "t:sections.main-collection-product-grid.settings.quick_add.label",
        "info": "t:sections.main-collection-product-grid.settings.quick_add.info",
        "options": [
          {
            "value": "none",
            "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_1"
          }, {
            "value": "standard",
            "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_2"
          }, {
            "value": "bulk",
            "label": "t:sections.main-collection-product-grid.settings.quick_add.options.option_3"
          }
        ]
      }, {
        "type": "header",
        "content": "Promo banner"
      }, {
        "type": "text",
        "id": "promo_banner",
        "label": "Promo banner placement",
        "placeholder": "enter a number",
        "default": "5"
      }, {
        "type": "text",
        "id": "promo_banner_text",
        "label": "Promo banner text",
        "default": "JUST IN"
      }, {
        "type": "text",
        "id": "promo_banner_text_2",
        "label": "Promo banner text",
        "default": "40"
      }, {
        "type": "text",
        "id": "promo_banner_text_min",
        "label": "Promo banner text",
        "default": "Limited time only"
      }, {
        "type": "text",
        "id": "promo_banner_btn_text",
        "label": "Promo banner button text",
        "default": "SHOP NOW"
      }, {
        "type": "color_scheme",
        "id": "pr_color_scheme",
        "label": "promo banner color scheme",
        "default": "scheme-3"
      }, {
        "type": "color_scheme",
        "id": "pr_color_scheme_2",
        "label": "promo banner color scheme",
        "default": "scheme-6"
      }, {
        "type": "header",
        "content": "t:sections.main-collection-product-grid.settings.header__1.content"
      }, {
        "type": "checkbox",
        "id": "enable_filtering",
        "default": true,
        "label": "t:sections.main-collection-product-grid.settings.enable_filtering.label",
        "info": "t:sections.main-collection-product-grid.settings.enable_filtering.info"
      }, {
        "type": "select",
        "id": "filter_type",
        "options": [
          {
            "value": "horizontal",
            "label": "t:sections.main-collection-product-grid.settings.filter_type.options__1.label"
          }, {
            "value": "vertical",
            "label": "t:sections.main-collection-product-grid.settings.filter_type.options__2.label"
          }, {
            "value": "drawer",
            "label": "t:sections.main-collection-product-grid.settings.filter_type.options__3.label"
          }
        ],
        "default": "horizontal",
        "label": "t:sections.main-collection-product-grid.settings.filter_type.label",
        "info": "t:sections.main-collection-product-grid.settings.filter_type.info"
      }, {
        "type": "checkbox",
        "id": "enable_sorting",
        "default": true,
        "label": "t:sections.main-collection-product-grid.settings.enable_sorting.label"
      }, {
        "type": "header",
        "content": "t:sections.main-collection-product-grid.settings.header_mobile.content"
      }, {
        "type": "select",
        "id": "columns_mobile",
        "default": "2",
        "label": "t:sections.main-collection-product-grid.settings.columns_mobile.label",
        "options": [
          {
            "value": "1",
            "label": "t:sections.main-collection-product-grid.settings.columns_mobile.options__1.label"
          }, {
            "value": "2",
            "label": "t:sections.main-collection-product-grid.settings.columns_mobile.options__2.label"
          }
        ]
      }, {
        "type": "header",
        "content": "t:sections.all.padding.section_padding_heading"
      }, {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_top",
        "default": 36
      }, {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_bottom",
        "default": 36
      }
    ]
  }
{% endschema %}